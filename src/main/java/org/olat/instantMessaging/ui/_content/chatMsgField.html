<div class="o_instantmessaging_chat_history" id="$id">
	#foreach($message in $chatMessages)
		<div class="b_clearfix">
			#if($message.first)
				<div class="o_instantmessaging_avatar">
					#if($message.anonym)
						<img src='$r.staticLink("themes/openolat/images/dummy.png")' width="50" height="50"/>
					#elseif($message.avatarKey)
						<img src='${avatarBaseURL}/${message.avatarKey}/avatar.jpg' />
					#else
						<img src='$r.staticLink("themes/openolat/images/dummy.png")' width="50" height="50"/>
					#end
				</div>
				<span class="o_instantmessaging_from b_float_left b_small">${message.from}</span>
			#end
			<p class="o_instantmessaging_body">
			<span class="o_instantmessaging_date b_float_right b_small">${message.creationDate}</span><br/>
			${message.body}</p>
		</div>
	#end
</div>
#if($focus)
	<script>jQuery(function(){try{focus_${panelName}();}catch(e){}});</script>
#else
	<script>jQuery(function(){try{tweak_${panelName}();}catch(e){}});</script>
#end
<script type="text/javascript">
/* <![CDATA[ */
	//setTimeout used because otherwise it would not work the first time the chatwindow is displayed
	setTimeout(function() {
		var d = $("$id");
		if (d && d.offsetHeight < d.scrollHeight) d.scrollTop = d.scrollHeight + 13;
	}, 42);
/* ]]> */ 
</script>