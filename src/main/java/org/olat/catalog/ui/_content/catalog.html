<div class="o_catalog">
	## first render bread-crumb category navigation
	#set ($lastIndex = $history.size() - 1)
	#set ($ri = 0)
	<ol class="breadcrumb">
		#foreach($child in $history)
			#if($ri < $lastIndex)
				<li><a href="$r.commandURIbg("history$ri")" onclick="return o2cl()"  onkeypress="return o2cl()" $r.bgTarget()>$r.escapeHtml($child.getName())</a></li>
			#else
				<li class='active'><strong>$r.escapeHtml($child.getName())</strong></li>
			#end
			#set ($ri = $ri +1)
		#end
	</ol>
	
	## render category description
	<div class="o_catalog">
		<div class="o_level o_level_${catalogLevel}">
			<div class="o_visual">
				#if($r.available("catThumbnail"))
					$r.render("catThumbnail")
				#else
					<div class="o_visual_not_available"></div>			
				#end
			</div>
			<div class="o_meta clearfix">
				<h2 class="o_title">$r.escapeHtml($currentCatalogEntry.getName())</h2>
				#if($currentCatalogEntry.getDescription())	
				<div class="o_desc">$r.xssScan($currentCatalogEntry.getDescription())</div>
				#end
			</div>
		</div>
	</div>
		
	## calculate some temporary variables
	#set($hasChildren = false)
	#set($hasSubcats = false)
	#foreach($child in $children)
		#if ($child.getType()==$leaf)
			#set($hasChildren = true)
		#else
			#set($hasSubcats = true)
		#end
	#end	
	
	## render subcatecories of current category
	#if ($hasSubcats)
		<div class="o_catalog_itemlist">
			<ul class="list-unstyled">
			#set ($ri = 0)
			#foreach($child in $children)
				#if ($child.getType()==$node)
					<li><a href="$r.commandURIbg("child$ri")" onclick="return o2cl()"  onkeypress="return o2cl()" $r.bgTarget()>
						<i class="o_icon o_icon_catalog_sub"> </i> $r.escapeHtml($child.getName())</span> 
					</a></li>
				#end
				#set ($ri = $ri +1)
			#end
			</ul>
		</div>
	#end
	
	## render list of children items: repository entries in this category
	#set ($ri = 0)
	#set ($i = 0)
	#if ($hasChildren)
		<h4>$r.translate("title.leaves")</h4>
		<table class="table">
		#foreach($child in $children)
			#if ($child.getType()==$leaf)
				<tr>
					<td>
						<a href="$r.commandURIbg("leaf$ri")" onclick="return o2cl()"  onkeypress="return o2cl()" $r.bgTarget() class="">
							<i class="o_icon ${iconRenderer.getIconCssClass($child.getRepositoryEntry())}"> </i> <span id="leaf$ri">$r.escapeHtml($child.getRepositoryEntry().getDisplayname())</span>
						</a>
						#set ($repoDesc = $child.getRepositoryEntry().getFormattedDescription())
						#if($r.available("image$ri") || ($repoDesc && $repoDesc.length() > 0))
						<div id="o_tooltip_$ri" style="display:none;">
							#if($r.available("image$ri"))
								<div class="o_repository_resource_image">$r.render("image$ri")</div>
								<div class="o_tooltip_wrapper" style="min-height:110px">$repoDesc</div>
							#else
								<div class="o_tooltip_wrapper">$repoDesc</div>
							#end								
						</div>
<script type="text/javascript">
/* <![CDATA[ */
jQuery(function() {
	jQuery('#leaf$ri').tooltip({
		html: true,
		title: function(){ return jQuery('#o_tooltip_$ri').html(); }	
	});
});
/* ]]> */
</script>
					#end
					#if ($canRemoveAllLinks || $hasOwnedLinks)
						#if($canRemoveAllLinks || $ownedLinks.contains($child))
							</td><td>	
								  <a href="$r.commandURIbg("edit.leaf$ri")" onclick="return o2cl()"  onkeypress="return o2cl()" $r.bgTarget()>$r.translate("edit")</a>
							</td><td>
								<a href="$r.commandURIbg("remove.leaf$ri")" onclick="return o2cl()"  onkeypress="return o2cl()" $r.bgTarget()>$r.translate("delete")</a>
							</td><td>
								<a href="$r.commandURIbg("move.leaf$ri")" onclick="return o2cl()"  onkeypress="return o2cl()" $r.bgTarget()>$r.translate("move")</a>
						#end
					#end
					</td><td>
						<a href="$r.commandURIbg("detail.leaf$ri")" onclick="return o2cl()" onkeypress="return o2cl()" $r.bgTarget()>$r.translate("details.header")</a>
					</td>				
				</tr>
				#set ($i = $i +1)
			#end
			#set ($ri = $ri +1)
		#end
		</table>
	#else
		#if (!$hasSubcats)
			<i>$r.translate("no.leaves")</i>
		#end
	#end
	
	<div class="o_catalog_links">
	#o_togglebox_start("o_catalog_extlink" $r.translate("cat.externalLink"))
		#if($extLink)
			<pre>$extLink</pre>
		#end
		<pre>$guestExtLink</pre>
	#o_togglebox_end()
	</div>
</div>