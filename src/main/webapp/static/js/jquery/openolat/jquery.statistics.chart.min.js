(function(a){a.fn.qtiStatistics=function(d,b){var c=a.extend({values:[],colors:[],cut:null,participants:-1,barHeight:40,xTopLegend:"x Top",xBottomLegend:"x Bottom",yLeftLegend:"y Left",yRightLegend:"y Right"},b);try{if(d=="histogramScore"){histogramScore(this,c)}else{if(d=="histogramDuration"){histogramDuration(this,c)}else{if(d=="horizontalBarSingleChoice"){horizontalBarSingleChoice(this,c)}else{if(d=="rightAnswerPerItem"){rightAnswerPerItem(this,c)}else{if(d=="averageScorePerItem"){averageScorePerItem(this,c)}else{if(d=="horizontalBarMultipleChoice"){horizontalBarMultipleChoice(this,c)}else{if(d=="horizontalBarMultipleChoiceSurvey"){horizontalBarMultipleChoiceSurvey(this,c)}}}}}}}}catch(f){if(console){console.log(f)}}return this};averageScorePerItem=function(b,f){var m=b.height();var j=b.width();var h=f.values;var g={top:10,right:60,bottom:40,left:60},d=j-g.left-g.right,n=m-g.top-g.bottom;var l=d3.scale.linear().domain([0,d3.max(h,function(o){return o[1]})]).range([0,d]);var e=d3.svg.axis().scale(l).orient("bottom").ticks(10);var k=d3.scale.ordinal().domain(h.map(function(o){return o[0]})).rangeRoundBands([n,0]);var c=d3.svg.axis().scale(k).orient("left");var i=d3.select("#"+b.attr("id")).append("svg").attr("width",d+g.left+g.right).attr("height",n+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")");i.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(e).append("text").attr("y",(g.bottom/1.7)).attr("x",(d/2)).attr("dy","1em").style("text-anchor","middle").text(f.xBottomLegend);i.selectAll(".bar0").data(h).enter().append("rect").attr("class","bar bar0 bar_default").attr("fill","bar_default").attr("x",0).attr("y",function(o){return k(o[0])+2}).attr("width",function(o){return l(o[1])}).attr("height",k.rangeBand()-4);i.append("g").attr("class","y axis").call(c).append("text").attr("transform","rotate(-90)").attr("y",0-(g.right/1.7)).attr("x",0-(n/2)).attr("dy","1em").style("text-anchor","middle").text(f.yLeftLegend)};rightAnswerPerItem=function(c,h){var p=c.height();var l=c.width();var j=h.values;var i={top:40,right:60,bottom:40,left:60},f=l-i.left-i.right,q=p-i.top-i.bottom;var m=d3.sum(j,function(r){return r[1]});var o=d3.scale.linear().domain([0,d3.max(j,function(r){return r[1]})]).range([0,f]);var g=d3.svg.axis().scale(o).orient("top").ticks(10);var e=d3.scale.linear().domain([0,d3.max(j,function(r){return r[1]/m})]).range([0,f]);var b=d3.svg.axis().scale(e).orient("bottom").ticks(10,"%");var n=d3.scale.ordinal().domain(j.map(function(r){return r[0]})).rangeRoundBands([q,0]);var d=d3.svg.axis().scale(n).orient("left");var k=d3.select("#"+c.attr("id")).append("svg").attr("width",f+i.left+i.right).attr("height",q+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")");k.append("g").attr("class","x axis").attr("transform","translate(0,0)").call(g).append("text").attr("y",0-(i.top/1.1)).attr("x",(f/2)).attr("dy","1em").style("text-anchor","middle").text(h.xBottomLegend);k.append("g").attr("class","x axis").attr("transform","translate(0,"+q+")").call(b).append("text").attr("y",(i.bottom/1.7)).attr("x",(f/2)).attr("dy","1em").style("text-anchor","middle").text(h.xTopLegend);k.selectAll(".bar0").data(j).enter().append("rect").attr("class","bar bar0 bar_green").attr("fill","bar_green").attr("x",0).attr("y",function(r){return n(r[0])+2}).attr("width",function(r){return o(r[1])}).attr("height",n.rangeBand()-4);k.append("g").attr("class","y axis").call(d).append("text").attr("transform","rotate(-90)").attr("y",0-(i.right/1.7)).attr("x",0-(q/2)).attr("dy","1em").style("text-anchor","middle").text(h.yLeftLegend)};horizontalBarMultipleChoiceSurvey=function(c,i){var m=c.width();var k=i.values;var d=i.colors;var j={top:40,right:10,bottom:40,left:40};var r=k.length*i.barHeight;c.height(r+j.top+j.bottom+"px");var g=m-j.left-j.right;var n=i.participants;var p=d3.max(k,function(s){return s[1]});var q=d3.scale.linear().domain([0,p]).range([0,g]);var h=d3.svg.axis().scale(q).orient("top").ticks(p);var f=d3.scale.linear().domain([0,d3.max(k,function(s){return(s[1])/n})]).range([0,g]);var b=d3.svg.axis().scale(f).orient("bottom").ticks(10,"%");var o=d3.scale.ordinal().domain(k.map(function(s){return s[0]})).rangeRoundBands([r,0]);var e=d3.svg.axis().scale(o).orient("left");var l=d3.select("#"+c.attr("id")).append("svg").attr("width",g+j.left+j.right).attr("height",r+j.top+j.bottom).append("g").attr("transform","translate("+j.left+","+j.top+")");l.append("g").attr("class","x axis").attr("transform","translate(0,0)").call(h).append("text").attr("y",0-(j.top/1.1)).attr("x",(g/2)).attr("dy","1em").style("text-anchor","middle").text(i.xTopLegend);l.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(b).append("text").attr("y",(j.bottom/1.7)).attr("x",(g/2)).attr("dy","1em").style("text-anchor","middle").text(i.xBottomLegend);l.append("g").attr("class","y axis").call(e).append("text").attr("transform","rotate(-90)").attr("y",0-j.left).attr("x",0-(r/2)).attr("dy","1em").style("text-anchor","middle").text(i.yLeftLegend);l.selectAll(".bar0").data(k).enter().append("rect").attr("class","bar bar_default").attr("fill","bar_default").attr("x",0).attr("y",function(s){return o(s[0])+2}).attr("width",function(s){return q(s[1])}).attr("height",o.rangeBand()-4)};horizontalBarMultipleChoice=function(c,i){var m=c.width();var k=i.values;var d=i.colors;var j={top:40,right:10,bottom:40,left:40};var r=k.length*i.barHeight;c.height(r+j.top+j.bottom+"px");var g=m-j.left-j.right;var n=i.participants;var p=d3.max(k,function(s){return s[1]+s[2]+s[3]});var q=d3.scale.linear().domain([0,p]).range([0,g]);var h=d3.svg.axis().scale(q).orient("top").ticks(p);var f=d3.scale.linear().domain([0,d3.max(k,function(s){return(s[1]+s[2]+s[3])/n})]).range([0,g]);var b=d3.svg.axis().scale(f).orient("bottom").ticks(10,"%");var o=d3.scale.ordinal().domain(k.map(function(s){return s[0]})).rangeRoundBands([r,0]);var e=d3.svg.axis().scale(o).orient("left");var l=d3.select("#"+c.attr("id")).append("svg").attr("width",g+j.left+j.right).attr("height",r+j.top+j.bottom).append("g").attr("transform","translate("+j.left+","+j.top+")");l.append("g").attr("class","x axis").attr("transform","translate(0,0)").call(h).append("text").attr("y",0-(j.top/1.1)).attr("x",(g/2)).attr("dy","1em").style("text-anchor","middle").text(i.xTopLegend);l.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(b).append("text").attr("y",(j.bottom/1.7)).attr("x",(g/2)).attr("dy","1em").style("text-anchor","middle").text(i.xBottomlegend);l.append("g").attr("class","y axis").call(e).append("text").attr("transform","rotate(-90)").attr("y",0-j.left).attr("x",0-(r/2)).attr("dy","1em").style("text-anchor","middle").text(i.yLeftLegend);l.selectAll(".bar0").data(k).enter().append("rect").attr("class","bar bar_green").attr("fill","bar_green").attr("x",0).attr("y",function(s){return o(s[0])+2}).attr("width",function(s){return q(s[1])}).attr("height",o.rangeBand()-4);l.selectAll(".bar1").data(k).enter().append("rect").attr("class","bar bar_red").attr("fill","bar_red").attr("x",function(s){return q(s[1])}).attr("y",function(s){return o(s[0])+2}).attr("width",function(s){return q(s[2])}).attr("height",o.rangeBand()-4);l.selectAll(".bar2").data(k).enter().append("rect").attr("class","bar bar_grey").attr("fill","bar_grey").attr("x",function(s){return q(s[1]+s[2])}).attr("y",function(s){return o(s[0])+2}).attr("width",function(s){return q(s[3])}).attr("height",o.rangeBand()-4)};horizontalBarSingleChoice=function(c,i){var m=c.width();var k=i.values;var d=i.colors;var j={top:40,right:10,bottom:40,left:40};var r=k.length*i.barHeight;c.height(r+j.top+j.bottom+"px");var g=m-j.left-j.right;var n=d3.sum(k,function(s){return s[1]});var p=d3.max(k,function(s){return s[1]});var q=d3.scale.linear().domain([0,p]).range([0,g]);var h=d3.svg.axis().scale(q).orient("top").ticks(p);var f=d3.scale.linear().domain([0,d3.max(k,function(s){return s[1]/n})]).range([0,g]);var b=d3.svg.axis().scale(f).orient("bottom").ticks(10,"%");var o=d3.scale.ordinal().domain(k.map(function(s){return s[0]})).rangeRoundBands([r,0]);var e=d3.svg.axis().scale(o).orient("left");var l=d3.select("#"+c.attr("id")).append("svg").attr("width",g+j.left+j.right).attr("height",r+j.top+j.bottom).append("g").attr("transform","translate("+j.left+","+j.top+")");l.append("g").attr("class","x axis").attr("transform","translate(0,0)").call(h).append("text").attr("y",0-(j.top/1.1)).attr("x",(g/2)).attr("dy","1em").style("text-anchor","middle").text(i.xTopLegend);l.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(b).append("text").attr("y",(j.bottom/1.7)).attr("x",(g/2)).attr("dy","1em").style("text-anchor","middle").text(i.xBottomLegend);l.selectAll(".bar0").data(k).enter().append("rect").attr("class",function(t,s){if(d==null){return"bar bar0 bar_default"}else{if(d.length>s){return d[s]}else{return"bar bar0 bar_default"}}}).attr("fill","bar_green").attr("x",0).attr("y",function(s){return o(s[0])+2}).attr("width",function(s){return q(s[1])}).attr("height",o.rangeBand()-4);l.append("g").attr("class","y axis").call(e).append("text").attr("transform","rotate(-90)").attr("y",0-j.left).attr("x",0-(r/2)).attr("dy","1em").style("text-anchor","middle").text(i.yLeftLegend)};histogramDuration=function(s,r){var c=s.height();var o=s.width();var e=r.values;var t=d3.format(",.f"),u=d3.time.format("%H:%M"),j=function(w){return u(new Date(2012,0,1,0,w))};var l={top:10,right:60,bottom:40,left:60},p=o-l.left-l.right,n=c-l.top-l.bottom;var k=d3.scale.linear().domain([0,4]).range([0,p]);var v=d3.layout.histogram().bins(k.ticks(20))(e);var g=d3.sum(v,function(w){return w.y});var i=d3.scale.linear().domain([0,d3.max(v,function(w){return w.y})]).range([n,0]);var f=d3.scale.linear().domain([0,d3.max(v,function(w){return w.y/g})]).range([n,0]);var h=d3.svg.axis().scale(k).orient("bottom").tickFormat(j);var b=d3.svg.axis().scale(i).orient("right").ticks(i.domain()[1]).tickSubdivide(0);var d=d3.svg.axis().scale(f).orient("left").ticks(10,"%");var m=d3.select("#"+s.attr("id")).append("svg").attr("width",p+l.left+l.right).attr("height",n+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")");var q=m.selectAll(".bar").data(v).enter().append("g").attr("class","bar bar_default").attr("transform",function(w){return"translate("+k(w.x)+","+i(w.y)+")"}).append("rect").attr("x",2).attr("width",k(v[0].dx)-4).attr("height",function(w){return n-i(w.y)});m.append("g").attr("class","y axis").call(d).append("text").attr("transform","rotate(-90)").attr("y",0-l.left).attr("x",0-(n/2)).attr("dy","1em").style("text-anchor","middle").text(r.yLeftLegend);m.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(h).append("text").attr("y",(l.bottom/1.1)).attr("x",(p/2)).attr("dx","1em").style("text-anchor","middle").text(r.xBottomLegend);m.append("g").attr("class","y axis").attr("transform","translate("+p+",0)").call(b).append("text").attr("transform","rotate(90)").attr("y",0-(l.right)).attr("x",(n/2)).attr("dy","1em").style("text-anchor","middle").text(r.yLeftLegend)};histogramScore=function(s,r){var c=s.height();var o=s.width();var d=r.values;var l={top:10,right:60,bottom:40,left:60},p=o-l.left-l.right,n=c-l.top-l.bottom;var f=r.cut;var k=d3.scale.linear().domain([0,3]).range([0,p]);var t=d3.layout.histogram().bins(k.ticks(20))(d);var h=d3.sum(t,function(u){return u.y});var j=d3.scale.linear().domain([0,d3.max(t,function(u){return u.y})]).range([n,0]);var g=d3.scale.linear().domain([0,d3.max(t,function(u){return u.y/h})]).range([n,0]);var i=d3.svg.axis().scale(k).orient("bottom").tickFormat(d3.format(".01f"));var b=d3.svg.axis().scale(j).orient("right").ticks(j.domain()[1]).tickSubdivide(0);var e=d3.svg.axis().scale(g).orient("left").ticks(10,"%");var m=d3.select("#"+s.attr("id")).append("svg").attr("width",p+l.left+l.right).attr("height",n+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")");var q=m.selectAll(".bar").data(t).enter().append("g").attr("class",function(v,u){if(f==null){return"bar bar_default"}else{if(t[u].x<f){return"bar bar_red"}else{return"bar bar_green"}}}).attr("transform",function(u){return"translate("+k(u.x)+","+j(u.y)+")"}).append("rect").attr("x",2).attr("width",k(t[0].dx)-4).attr("height",function(u){return n-j(u.y)});m.append("g").attr("class","y axis").call(e).append("text").attr("transform","rotate(-90)").attr("y",0-l.left).attr("x",0-(n/2)).attr("dy","1em").style("text-anchor","middle").text(r.yLeftLegend);m.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(i).append("text").attr("y",(l.bottom/1.1)).attr("x",(p/2)).attr("dx","1em").style("text-anchor","middle").text(r.xBottomLegend);m.append("g").attr("class","y axis").attr("transform","translate("+p+",0)").call(b).append("text").attr("transform","rotate(90)").attr("y",0-(l.right)).attr("x",(n/2)).attr("dy","1em").style("text-anchor","middle").text(r.yRightLegend)}}(jQuery));